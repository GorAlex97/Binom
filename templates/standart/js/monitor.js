!function(t){var r={};function e(a){if(r[a])return r[a].exports;var s=r[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var s in t)e.d(a,s,function(r){return t[r]}.bind(null,s));return a},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="templates/standart/js/",e(e.s=1022)}({1022:function(t,r,e){"use strict";$(document).ready((function(){var t=JSON.parse(window.JSONContainer);Chart.defaults.global.elements.line.borderWidth=1,Chart.defaults.global.elements.point.radius=.5,Chart.defaults.global.animation.duration=0;BINOM.monitorObj=new function(t){var r=this;this.drawed=!1,this.monitorData=t;var e=null,a=null,s=null,i=!0,n=void 0!==t.traffic_chart;function o(t){$.ajax({url:"",type:"post",data:{ajax:1,ajax_type:"write",type:t},success:function(t){setTimeout(r.getAsyncMonitorData(),500)}})}this.drawMonitor=function(){var t=r.drawWarningErrors(),e=r.drawUserTrackerInfo(),a=r.drawServerInfo(),s=n?r.drawChartContainer():"";return'\t\t\t\t<div class="analysis_block" style="max-width:790px;margin-top:0;box-sizing:border-box;font-size:13px;"><div style="align-items: center;justify-content: space-between;margin: -5px 0 15px 0;display: flex;grid-template-columns: 1fr auto 1fr;">\n\t\t\t\t     <div style="flex: 1 0 0;"></div>\n\t\t\t\t     <h3 style="flex: 1 0 0;font-size: 20px;text-align:center;margin: 0;">Monitor</h3>\n\t\t\t\t     <div style="flex: 1 0 0;"><div class="refresh-monitor-button blue-button" style="position: static;margin-left: auto;"><img src="templates/standart/images/w-refresh.png" class="icon"> Refresh </div></div>\n\t\t\t\t   </div>'+(t+e+r.drawLinks()+a+s)+r.drawUpdateCostClearingBlock()+"</div>"},this.drawLinks=function(){return'<div id="bnm-page-monitor-links" style="margin-left:130px; margin-bottom: 20px;" ><a style="margin-right: 15px;" target="_blank" href="http://binom.org/changelog">Changelog</a><a style="margin-right: 15px;" href="?page=analysis_system&amp;type=check_update">Check update</a><a href="?page=full_exit">Full Exit</a></div><div class="tt_error_wrapper"><div class="system-inline-message error"> <div class="system-inline-message__header">Update Error!</div> <div class="system-inline-message__sub-header"><span>Please, contact to our support.</span></div> <div id="monitor-check-update-error-text" class="system-inline-message__text"></div> </div></div>'},this.drawWarningErrors=function(){var t=r.drawWarnings(),e=r.drawErrors(),a="";if(""!=e+t&&(a='<div class="monitor_warnings_errors_block" >'+e+t+"</div>"),e){var s={messageType:"info",text:'<div style="margin-bottom:5px;">Please contact <a href="https://cp.binom.org/page/support" target="_blank">support.</a></div>'};a+=this.getInlineMessageHTML(s)}return a},this.drawWarnings=function(){var t,e=r.monitorData.warnings,a="";if(e)for(t in e)if(e.hasOwnProperty(t)){var s={messageType:"disclaimer",headerText:"Warning: "+t,text:e[t]};a+=this.getInlineMessageHTML(s)}return a},this.getInlineMessageHTML=function(t){return'<div class="system-inline-message '+(t.messageType||"")+'"><div class="system-inline-message__header">'+(t.headerText||"")+'</div><div class="system-inline-message__sub-header"><span>'+(t.subHeaderText||"")+'</span></div><div class="system-inline-message__text"><span>'+(t.text||"")+"</span></div></div>"},this.drawErrors=function(){var t,e=r.monitorData.errors,a="";if(e)for(t in e)if(e.hasOwnProperty(t)){if("300"==t)var s="Update Error";else s="Error: "+t;var i={messageType:"error",headerText:s,text:e[t]};a+=this.getInlineMessageHTML(i)}return a},this.drawUserTrackerInfo=function(){var t=r.monitorData.user_info,e=r.monitorData.tracker_info,a=$.cookie("days_left_lic"),s='<div><span class="monitor_row_title">User:</span> '+t.user_name+" (id:"+t.user_id+", Group: "+t.user_group+') <br><span class="monitor_row_title">Device:</span> '+t.user_device+" (OS:"+t.user_os+", Browser: "+t.user_browser+") </div>";return"<div>"+('<div><span class="monitor_row_title">Product:</span> <span>'+e.full_name+' </span><br><span class="monitor_row_title">License:</span> <span id="days_left_lic_span">'+a+" days</span></div>")+"<br>"+s+"</div>"},this.getDaysStringFromSeconds=function(t){return"Unknown"==t?"Unknown":(e=(r=t/86400)>=1?t%(24*Math.floor(r)*60*60)/3600:t/3600,a=r>=1?t%(24*Math.floor(r)*60*60+60*Math.floor(e)*60)/60:(t-60*Math.floor(e)*60)/60,Math.floor(r)+" Days "+Math.floor(e)+" h. "+Math.floor(a)+" m. ");var r,e,a},this.fetchDBSize=function(){$.ajax({type:"post",url:"",data:{ajax:1,type:"get_db_size"},success:function(t){var r=JSON.parse(t);if(0!=r.size_db&&"oops"!=r.size_db){var e=(r.size_db/1e3).toFixed(1),a=((r.size_db_report/1e3).toFixed(1),(r.size_db_clicks/1e3).toFixed(1),"; DB Size: "+e+" GB ");$(".db_size_span").html(a),$(".db_size_span").css("color","")}else $(".db_size_span").html("")}})},this.drawServerInfo=function(){var t=r.monitorData.server_info,e=r.monitorData.load.load,a=(r.monitorData.db_size,r.drawProgressBar(e,!0));this.fetchDBSize();var s="unknown"==(""+t.rom_total).toLowerCase()?t.rom_total:"Total: "+(t.rom_total/1e3).toFixed(1)+" GB; Free: "+(t.rom_free/1e3).toFixed(1)+" GB";t.script_status?t.script_status='<div style="margin-bottom: 5px;">'+t.script_status+"</div>":t.script_status="",s+='<span style="color:#ccc" class="db_size_span"> DB SIZE LOADING </span>';var i=t.cpu_name+" <b>Cores:</b> "+t.cpu_cores+" ("+t.cpu_siblings+")",n="unknown"==(""+t.ram_total).toLowerCase()?t.ram_total:(t.ram_total/1e3).toFixed(1)+" GB",o="";return t.check_ssd||"ssd"==t.check_ssd.toLowerCase()?o="(SSD)":(t.check_ssd||"hdd"==t.check_ssd.toLowerCase())&&(o="(HDD)"),"<div >"+t.script_status+'<div><span class="monitor_row_title">ROM '+o+":</span> "+s+'</div><div><span class="monitor_row_title">RAM Total:</span> '+n+'</div><div><span class="monitor_row_title">CPU:</span> '+i+'</div><div><span class="monitor_row_title monitor_row_title--php">PHP Version:</span> <span style="display: inline-block;max-width: 550px;">'+t.php_v+'</span></div><div><span class="monitor_row_title monitor_row_title--mysql">MySQL Version:</span> <span style="display: inline-block;max-width: 550px;">'+t.mysql_v+'</span></div><div><span class="monitor_row_title">OS Version:</span> '+t.os_v+'</div><div><span class="monitor_row_title">Uptime:</span> '+r.getDaysStringFromSeconds(t.uptime)+'</div><div><span class="monitor_row_title">Server Type:</span> '+t.server+'</div><div style="display: flex;"><span class="monitor_row_title">Load Now:</span>&nbsp;<div style="width:100px;display:inline-block;width:200px;">'+a+"</div></div></div><br>"},this.drawErrorProgressBar=function(){return'<div class="progress-bar progress-bar-monitor-load error-load">\t\t\t\t\t\t\t<div class="filling" style="width: 0%;">\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<span class="rating_score">Error. <a href=\'#\' id=\'restartClearButton\' >Restart</a></span></div>'},this.drawStopProgressBar=function(){return'<div class="progress-bar progress-bar-monitor-load little-load">\t\t\t\t\t\t\t<div class="filling" style="width: 0%;">\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<span class="rating_score">Process is stopped. <a href=\'#\' id=\'restartClearButton\' >Restart</a></span></div>'},this.drawProgressBar=function(t,r){var e=t||0;return'<div class="progress-bar progress-bar-monitor-load '+((r=r||!1)?e<=90?"little-load":e<=95?"normal-load":"strong-load":"little-load")+'">\t\t\t\t\t\t\t<div class="filling" style="width: '+e+'%;">\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<span class="rating_score">'+(e+" %")+"</span></div>"},this.drawChartContainer=function(){return'<div class="monitor-chart-wrapper"><canvas id="trafficChart"></canvas></div><div class="chart-slider"></div>'},this.getDataForTrafficChart=function(t,e){var a=r.monitorData.traffic_chart,s=a.time.slice(0),i=a.clicks.slice(0);if(t&&e){var n=s.indexOf(t),o=s.indexOf(e)+1;s=s.slice(n,o),i=i.slice(n,o)}return[s,i]},this.updateChart=function(t){null!=e&&(e.data.labels=t[0].slice(0),e.data.datasets[0].data=t[1].slice(0),e.update())},this.generateChart=function(t,a){t=t||!1,a=a||!1;var s=r.getDataForTrafficChart(t,a),i=document.getElementById("trafficChart").getContext("2d");e=new Chart(i,{type:"line",data:{labels:s[0],datasets:[{label:"Clicks "+(new Date).toDateString(),backgroundColor:"rgba(71, 108, 255, 0.4)",borderColor:"rgb(71, 108, 255)",data:s[1],fill:"start"}]},options:{scales:{xAxes:[{ticks:{maxTicksLimit:24}}],yAxes:[{ticks:{beginAtZero:!0}}]}}})},this.drawSlider=function(){var t=r.monitorData.traffic_chart.time,e=r.monitorData.traffic_chart.time.indexOf(s);(-1==e||i)&&(e=r.monitorData.traffic_chart.time.length-1),$(".chart-slider").ionRangeSlider({type:"double",grid:!0,values:r.monitorData.traffic_chart.time,from:r.monitorData.traffic_chart.time.indexOf(a),to:e,onFinish:function(e){a=e.from_value,s=e.to_value,t.indexOf(s)!=t.length-1&&(i=!1);var n=r.getDataForTrafficChart(a,s);r.updateChart(n)}})},this.drawUpdateCostClearingBlock=function(){var t=r.drawUpdateCosts(),e=r.drawClearings(),a="";return""!=t+e&&(a='<div class="monitor-updates-clearing-block">'+t+e+"</div>"),a},this.drawUpdateCosts=function(){var t=r.monitorData.tracker_process_list||[];t.length>0&&(t=t.filter((function(t){return"Update cost"==t.name})));var e="";return t.forEach((function(t){var a=r.drawProgressBar(t.progress.replace("%",""),!1);e+='<div class="monitor-updates-clearing-chunk monitor-updates-clearing-chunk-update-cost"><div style="margin-bottom:5px;margin-top:5px;"><span class="monitor_row_title monitor_row_title_narrow">Processing: </span>'+t.time+' s.</div><div><span class="monitor_row_title monitor_row_title_narrow">Progress: </span>'+a+"</div></div>"})),""!=e&&(e=`\n\t\t\t\t<h3 style="text-align:center;margin:0;padding-top: 5px;padding-bottom: 5px;" class="monitor-updates-clearing-block__block-title-slider" onclick="easySlider(this)">\n\t\t\t\t\t<img class="easy-toggler-img" style="cursor:pointer;" src="templates/standart/images/arrow_down.png" >\n\t\t\t\t\tCost Updates\n\t\t\t\t</h3>\n\t\t\t\t<div style="display:block;">\n\t\t\t\t\t${e}\n\t\t\t\t</div>\n\t\t\t\t`),""!=e&&(e=`<div class="monitor-updates-clearing__main-section">${e}</div>`),e},this.drawClearings=function(){if(!r.monitorData.clear_process||0==r.monitorData.clear_process.length)return"";var t=r.monitorData.clear_process||[],e=!1;r.monitorData.clear_process.some((function(t){return 0!=t.status&&(e=t,!0)}));var a,s=r.monitorData.clear_process.some((function(t){var r=t.status;return 0===parseInt(r,10)||"stop"===r})),i="";function n(t){return s?'<button style="margin-top:10px;'+(i?"margin-left: 15px;":"")+'" id="deleteClearButton" class="bnm-button bnm-button-blue">Delete '+t+"</button>":""}if(e){if("stop"==e.status)var o=this.drawStopProgressBar(e.status,!1);else if("error"==e.status)o=this.drawErrorProgressBar(e.status,!1);else o=this.drawProgressBar(e.status,!1),i='<button style="margin-top:10px;" id="stopClearButton" class="bnm-button bnm-button-green">Pause</button>';a=`\n\t\t\t\t\t<div class="monitor-updates-clearing-block__clearing_now">\n\t\t\t\t\t\t<b>Clearing now:</b><br/>\n\t\t\t\t\t\t<span>Campaign ID: ${e.camp_id}</span>\n\n\t\t\t\t\t\t<div style="margin-top:10px;">\n\t\t\t\t\t\t\t${o}\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t\t${n("all")}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}else a=`\n\t\t\t\t\t<div\n\t\t\t\t\t  class="monitor-updates-clearing-block__clearing_now"\n\t\t\t\t\t>\n            <div>There is no active clearing.</div>\n          \n\t\t\t\t\t  ${n("scheduled clearings")}\n\t\t\t\t\t</div>\n\t\t\t\t`;var l="";if(t&&null!=t[0]){var c={},d=[];t.forEach((function(t,r){t.start_clear.substr(0,4)<moment().year()?d.push(t):c[t.start_clear]?c[t.start_clear].push(t):c[t.start_clear]=[t]}));var p="";d.length>0&&(p+='\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h3 class="monitor-updates-clearing-block__hot-query-slider micro-base-block-title" onclick="easySlider(this)"> \n\t\t\t\t\t\t\t\t<img class="easy-toggler-img" style="cursor:pointer;position:relative;bottom:2px;" src="templates/standart/images/arrow_up.png" >\n\t\t\t\t\t\t\t\tCurrent clearings\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div style="display:none;" class="monitor-updates-clearing-block__clearing_query">\n\t\t\t\t\t',d.forEach((t,r)=>{p+="<span>"+t.camp_id+(r!=d.length-1?", ":"")+"</span>"}),p+="</div>");var u=Object.keys(c);(u=u.sort()).forEach((function(t){l+=`\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h3 class="monitor-updates-clearing-block__query-date-slider" onclick="easySlider(this)"> \n\t\t\t\t\t\t\t\t<img class="easy-toggler-img" style="cursor:pointer;" src="templates/standart/images/arrow_up.png" >\n\t\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<div style="display:none;" class="monitor-updates-clearing-block__clearing_query">\n\t\t\t\t\t`,c[t].forEach((function(r,a){if(!e||r.camp_id!=e.camp_id){"1970-01-01 00:00"==r.start_clear?"query":"Starting at "+r.start_clear,l+="<span>"+r.camp_id+(a!=c[t].length-1?", ":"")+"</span>"}})),l+="</div></div>"})),""!=l&&(l=`\n\t\t\t\t\t<h3 class="micro-base-block-title" onclick="easySlider(this)"> \n\t\t\t\t\t\t<img class="easy-toggler-img" style="cursor:pointer;" src="templates/standart/images/arrow_up.png" /> \n\t\t\t\t\t\tPlanned clearings\n\t\t\t\t\t</h3>\n\t\t\t\t\t<div class="clearing-list" style="display:none;">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\x3c!-- \n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<b>Clearing query:</b>\n\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t\t${l}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`)}return`\n\t\t\t\t<div class="monitor-updates-clearing__main-section">\n\t\t\t\t\t<h3 onclick="easySlider(this)" style="cursor:pointer;user-select:none;text-align:center;margin-top:0px;margin-bottom:5px;"> \n\t\t\t\t\t\t<img class="easy-toggler-img" style="cursor:pointer;position:relative;bottom:2px;" src="templates/standart/images/arrow_down.png" /> \n\t\t\t\t\t\tClearings\n\t\t\t\t\t</h3>\n\t\t\t\t\t<div style="display:block">\n\t\t\t\t\t\t${a+p+l}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`},this.init=function(){r.drawed||(r.draw(),this.setHandlers())},this.draw=function(){var t="";t+=r.drawMonitor(),$(".monitor_wrapper").html(t),r.drawed=!0,n&&(i&&(s=r.monitorData.traffic_chart.time[r.monitorData.traffic_chart.time.length-1]),r.generateChart(a,s),r.drawSlider())},this.redraw=function(){this.draw()},this.stopClear=function(){o("stopClear")},this.deleteClear=function(){makeConfirmModal("OK","Cancel",(function(){o("delClear")}),"","Are you sure you want to delete all clearings?",{closing_ok_wrap:!0}).show()},this.restartClear=function(){o("restartClear")},this.getAsyncMonitorData=function(){$(".monitor_wrapper").find(".analysis_block").css("visibility"),null!=e&&e.destroy(),$.ajax({url:"",type:"post",data:{ajax:1,type:"get_monitor_data"},success:function(t){t=JSON.parse(t),r.monitorData=t,r.redraw()}})},this.toggleClearingShow=function(){var t=$(".monitor_wrapper").find(".clearing-list");"none"==t.css("display")?(t.css("display","block"),$(".clearing-toggler").replaceWith('<img class="clearing-toggler" style="cursor:pointer;" src="templates/standart/images/arrow_up.png" />')):(t.css("display","none"),$(".clearing-toggler").replaceWith('<img class="clearing-toggler" style="cursor:pointer;" src="templates/standart/images/arrow_down.png" />'))},this.setHandlers=function(){$(".monitor_wrapper").on("click",".refresh-monitor-button",r.getAsyncMonitorData),$(".monitor_wrapper").on("click","#restartClearButton",r.restartClear),$(".monitor_wrapper").on("click","#stopClearButton",r.stopClear),$(".monitor_wrapper").on("click","#deleteClearButton",r.deleteClear),$(".monitor_wrapper").on("click",".clearing-toggler",r.toggleClearingShow)}}(t),BINOM.monitorObj.init()}))}});